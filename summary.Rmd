---
title: "summary"
author: "Kate"
date: "November 11, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages and data, include=FALSE}

# Load necessary packages
library(tidyverse)
library(dunn.test)

# Load necessary data
smamms <- read_csv('smamms.csv')
meta <- read_csv('sites.csv')

```


```{r simplified data frame}

# Create combined and simplified data frame with only unique animals
smammeta <- full_join(smamms, meta, by = c("site" = "site.code")) %>% 
  filter(species != 'MISS' & species != 'SPRU') %>% # remove SPRU and MISS
  group_by(indID) %>% 
  filter(row_number()==1) %>% # filter by unique animals
  ungroup() %>% 
  select(site, severity, species) %>% 
  mutate(
    severity = 
      case_when(
        severity == 'Green' ~ 'low',
        severity == 'Mixed' ~ 'med',
        severity == 'High' ~ 'high'
      )
  ) %>% 
  mutate(severity = factor(severity, levels = c('low', 'med', 'high')))

```


```{r proportional abundance column graph}

# Summary table

prop_summary <- smammeta %>% 
  group_by(site, species) %>% 
  summarize(n = length(species)) %>% 
  mutate(prop = n/sum(n))

sevs <- c(rep('low',9), rep('high',9), rep('med',9))
sevs <- factor(sevs, levels(c('low', 'med', 'high')))

prop_summary2 <- cbind(prop_summary, sevs)

# Create a column graph of proportional species abundance

prop_sp <- ggplot(prop_summary, aes(x = site, y = prop,
                                    fill = species)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

prop_sp

```


```{r}

low_n <- prop_summary %>% 
  select(site, species, n) %>% 
  filter(n<3)

high_n <- prop_summary %>% 
  select(site, species, n) %>% 
  filter(n>3)

```

